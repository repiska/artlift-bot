"""–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
import re
from typing import Optional
from bot.database.models import Database
from config.settings import settings


class MessageService:
    """–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    
    def __init__(self, db: Database):
        self._db = db
    
    @property
    def db(self):
        """–î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
        return self._db
    
    async def get_message(self, message_key: str, **variables) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"""
        template = await self._db.get_message(message_key)
        
        if template:
            content = template["content"]
        else:
            # Fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            content = self._get_default_message(message_key)
        
        # –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ settings
        all_variables = {
            "APPLICATION_FORM_URL": settings.APPLICATION_FORM_URL,
            "PAYMENT_URL": settings.PAYMENT_URL,
            "CONTACT_USERNAME": settings.CONTACT_USERNAME,
        }
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–æ–Ω–∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        all_variables.update(variables)
        
        # –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –∑–∞–º–µ–Ω—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        # –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
        for key, value in all_variables.items():
            # –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è {key} –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º str() –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            content = content.replace(f"{{{key}}}", str(value))
        
        # –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤ —à–∞–±–ª–æ–Ω–µ, –Ω–æ –Ω–µ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã)
        # –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ {VAR_NAME} –≤ –∏—Ç–æ–≥–æ–≤–æ–º —Ç–µ–∫—Å—Ç–µ
        content = re.sub(r'\{[^}]+\}', '', content)

        # –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–∏—Ç–∞—Ç—ã)
        content = self._apply_custom_formatting(content)
        
        return content
    
    async def update_message(self, message_key: str, content: str, admin_id: int) -> bool:
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏"""
        return await self._db.update_message(message_key, content, admin_id)
    
    async def get_all_messages(self) -> list:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤"""
        return await self._db.get_all_messages()
    
    async def get_message_history(self, message_key: str, limit: int = 10) -> list:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π —Å–æ–æ–±—â–µ–Ω–∏—è"""
        return await self._db.get_message_history(message_key, limit)
    
    async def get_history_item(self, history_id: int):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ ID"""
        return await self._db.get_history_item(history_id)
    
    async def restore_message_from_history(self, history_id: int, admin_id: int) -> bool:
        """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏"""
        return await self._db.restore_message_from_history(history_id, admin_id)
    
    async def delete_history_item(self, history_id: int) -> bool:
        """–£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏"""
        return await self._db.delete_history_item(history_id)
    
    def _get_default_message(self, message_key: str) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        defaults = {
            "welcome": (
                "–ü—Ä–∏–≤–µ—Ç! üëã\n\n"
                "–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ Art Lift Community!\n\n"
                "[b]Art Lift Community[/b] ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤, "
                "–∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∞—Ä—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤. –ú—ã –ø–æ–º–æ–≥–∞–µ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –∏ "
                "–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.\n\n"
                "[quote collapse][b]–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —á–ª–µ–Ω—Å—Ç–≤–æ:[/b]\n"
                "‚Ä¢ –û–±—â–µ–Ω–∏–µ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º Telegram-—á–∞—Ç–µ\n"
                "‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –∫–æ–º–∞–Ω–¥—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\n"
                "‚Ä¢ –í—Å—Ç—Ä–µ—á–∏ —Å —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏ –∞—Ä—Ç-—Ä—ã–Ω–∫–∞: –∫—É—Ä–∞—Ç–æ—Ä–∞–º–∏, –≥–∞–ª–µ—Ä–∏—Å—Ç–∞–º–∏, –∞—Ä—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏, "
                "—Ö—É–¥–æ–∂–Ω–∏–∫–∞–º–∏.\n"
                "‚Ä¢ –û–±–∑–æ—Ä—ã –Ω–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Å—Ñ–µ—Ä–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞\n"
                "‚Ä¢ –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ-—Ä–µ–≤—å—é\n"
                "‚Ä¢ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–µ–º –∞—Ä—Ç-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏\n"
                "‚Ä¢ Random coffee —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏\n"
                "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç –∫–æ–º—å—é–Ω–∏—Ç–∏\n"
                "[/quote]\n\n"
                "[b]–°—Ç–æ–∏–º–æ—Å—Ç—å[/b]:\n"
                "–ü–µ—Ä–≤—ã–π –ø—Ä–æ–±–Ω—ã–π –º–µ—Å—è—Ü ‚Äî 2 500 ‚ÇΩ\n"
                "–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Å—è—Ü—ã ‚Äî 5 000 ‚ÇΩ\n\n"
                "–ß—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É (3 –º–∏–Ω—É—Ç—ã):\n"
                "üëâ https://clck.ru/3Q4RJU\n\n"
                "–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∑–∞—è–≤–∫—É —Å–æ–≤—Å–µ–º "
                "—Å–∫–æ—Ä–æ –∏ –Ω–∞–ø–∏—à–µ–º –≤–∞–º."
            ),
            "main_menu": (
                "<b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n"
                "–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å."
            ),
            "application_filled_response": (
                "–û—Ç–ª–∏—á–Ω–æ! üéâ\n\n"
                "–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞ –∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞.\n"
                "–û–±—ã—á–Ω–æ –æ—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1‚Äì2 –¥–Ω–µ–π."
            ),
            "user_question_response": (
                "–°–ø–∞—Å–∏–±–æ! –ú—ã –ø–µ—Ä–µ–¥–∞–ª–∏ –≤–∞—à –≤–æ–ø—Ä–æ—Å –º–µ–Ω–µ–¥–∂–µ—Ä—É ‚Äî —Å–∫–æ—Ä–æ –æ–Ω –≤—ã–π–¥–µ—Ç –Ω–∞ —Å–≤—è–∑—å."
            ),
            "channel_subscribe_message": (
                "<b>Art Lift Community</b>\n\n"
                "–ù–∞–∂–º–∏—Ç–µ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É –∏ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ –∫–æ–º—å—é–Ω–∏—Ç–∏."
            ),
            "application_approved": (
                "{name}, —Å–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É!\n\n"
                "–ú—ã –æ—á–∞—Ä–æ–≤–∞–Ω—ã –≤–∞—à–∏–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏ –∏ —Ä–∞–¥—ã –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤–∞—Å –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ Art Lift!\n\n"
                "<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b>\n"
                "‚Ä¢ –ü–µ—Ä–≤—ã–π –º–µ—Å—è—Ü —Å–æ —Å–∫–∏–¥–∫–æ–π ‚Äî 2 500 ‚ÇΩ\n"
                "‚Ä¢ –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Å—è—Ü—ã ‚Äî 5 000 ‚ÇΩ\n\n"
                "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å @tribute:\n"
                f"üëâ {settings.PAYMENT_URL}\n\n"
                "–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É.\n\n"
                "–ö–∞–∫ –≤–æ–π–¥—ë—Ç–µ –≤ –∫–æ–º—å—é–Ω–∏—Ç–∏ ‚Äî –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ—Å—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ –±–ª–∏–∂–∞–π—à–∏–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º!\n\n"
                "–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –° —Ä–∞–¥–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ç–∏–º!"
            ),
            "application_rejected": (
                "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name}!\n\n"
                "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ –∑–∞—è–≤–∫—É –≤ Art Lift Community –∏ –∑–∞ —Ç–æ, —á—Ç–æ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å —Å–≤–æ–∏–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏.\n\n"
                "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –º—ã –Ω–µ –≥–æ—Ç–æ–≤—ã –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤–∞—Å –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ ‚Äî –º—ã —Å–ª–µ–¥–∏–º –∑–∞ —Ç–µ–º, "
                "—á—Ç–æ–±—ã —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –±—ã–ª–∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.\n\n"
                "–ù–æ –º—ã –±—É–¥–µ–º –æ—á–µ–Ω—å —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –ø–æ–∑–∂–µ! –ê –ø–æ–∫–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞:\n\n"
                "<b>1. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</b>\n\n"
                "–ú—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∞–µ–º –≤–∞—à–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å—Ç—Ä–µ—á—É –ø–æ–¥ –≤–∞—à –∑–∞–ø—Ä–æ—Å.\n\n"
                "<b>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:</b>\n"
                "‚Ä¢ –ê–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ\n"
                "‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–∞—á–µ –Ω–∞ –æ–ø–µ–Ω-–∫–æ–ª–ª—ã\n"
                "‚Ä¢ –û–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–∞–∑–≤–∏—Ç–∏—è\n"
                "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –¥–∏–∞–ª–æ–≥\n\n"
                "<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> –æ—Ç 8 000 ‚ÇΩ (60 –º–∏–Ω)\n"
                "–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.\n\n\n"
                "<b>2. –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ</b>\n\n"
                "–ì–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è, —á–µ–º —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ.\n\n"
                "–≠—Ç–æ —Ä–∞–±–æ—Ç–∞ –∫–∞–∫ —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π —Ö—É–¥–æ–∂–Ω–∏–∫–∞, —Ç–∞–∫ –∏ —Å –ø–æ–¥–±–æ—Ä–æ–º –≥–∞–ª–µ—Ä–µ–π –∏ —Å–º–µ–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤ –≤ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –ø–æ–ª–µ. "
                "–ò, —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ, ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∂–∏–≤—ã–µ —Å–µ—Å—Å–∏–∏ –≤ Zoom/Google Meet/Telegram.\n\n"
                "<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b>\n"
                "–†–∞–∑–±—Ä–æ—Å —Ü–µ–Ω –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π ‚Äî –≤—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–∞–º–æ–≥–æ –º–µ–Ω—Ç–æ—Ä–∞.\n\n"
                f"–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏—Ç–µ {settings.CONTACT_USERNAME} ‚Äî –ø–æ–¥–±–µ—Ä—ë–º —É—Å–ª—É–≥—É –∏ –≤—ã—à–ª–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ –º–µ–Ω—Ç–æ—Ä–∞–º üí¨"
            ),
            "faq": (
                "<b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</b>\n\n"
                "<b>–ß—Ç–æ —Ç–∞–∫–æ–µ Art Lift Community?</b>\n"
                "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤, –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∞—Ä—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.\n\n"
                "<b>–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —á–ª–µ–Ω—Å—Ç–≤–æ?</b>\n"
                "‚Ä¢ –û–±—â–µ–Ω–∏–µ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º Telegram-—á–∞—Ç–µ\n"
                "‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –∫–æ–º–∞–Ω–¥—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\n"
                "‚Ä¢ –í—Å—Ç—Ä–µ—á–∏ —Å —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏ –∞—Ä—Ç-—Ä—ã–Ω–∫–∞\n"
                "‚Ä¢ –û–±–∑–æ—Ä—ã –Ω–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Å—Ñ–µ—Ä–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞\n"
                "‚Ä¢ –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ-—Ä–µ–≤—å—é\n"
                "‚Ä¢ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–µ–º\n"
                "‚Ä¢ Random coffee —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏\n"
                "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç –∫–æ–º—å—é–Ω–∏—Ç–∏\n\n"
                "<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b>\n"
                "‚Ä¢ –ü–µ—Ä–≤—ã–π –ø—Ä–æ–±–Ω—ã–π –º–µ—Å—è—Ü ‚Äî 2 500 ‚ÇΩ\n"
                "‚Ä¢ –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Å—è—Ü—ã ‚Äî 5 000 ‚ÇΩ\n\n"
                "–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –ù–∞–∂–º–∏—Ç–µ ¬´‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å¬ª –≤ –º–µ–Ω—é, –∏ –º—ã –æ—Ç–≤–µ—Ç–∏–º –ª–∏—á–Ω–æ."
            ),
        }
        return defaults.get(message_key, "")

    def _apply_custom_formatting(self, content: str) -> str:
        """
        –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫ —à–∞–±–ª–æ–Ω—É —Å–æ–æ–±—â–µ–Ω–∏—è.

        –°–µ–π—á–∞—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:
        - [quote]...[/quote] -> <blockquote>...</blockquote>
        """
        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ [quote]...[/quote]
        def _quote_replacer(match: re.Match[str]) -> str:
            options = match.group(1) or ""
            inner_text = (match.group(2) or "").strip()

            if "collapse" in options:
                return f'<blockquote expandable="true">{inner_text}</blockquote>'

            return f"<blockquote>{inner_text}</blockquote>"

        content = re.sub(
            r"\[quote(?:\s+([^\]]+))?\](.*?)\[/quote\]",
            _quote_replacer,
            content,
            flags=re.DOTALL,
        )

        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        content = self._replace_simple_tags(content)

        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Å—ã–ª–æ–∫ –≤–∏–¥–∞ [text](url)
        content = re.sub(
            r"\[([^\]]+)\]\((https?://[^\s)]+)\)",
            lambda match: f'<a href="{match.group(2)}">{match.group(1)}</a>',
            content,
        )

        return content

    def _replace_simple_tags(self, content: str) -> str:
        """–ó–∞–º–µ–Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ–≥–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ HTML-–∞–Ω–∞–ª–æ–≥–∏"""
        tag_map = {
            "b": "b",
            "i": "i",
            "u": "u",
            "s": "s",
            "code": "code",
            "pre": "pre",
            "spoiler": 'span class="tg-spoiler"',
        }

        for tag, html_tag in tag_map.items():
            content = re.sub(
                rf"\[{tag}\](.*?)\[/{tag}\]",
                lambda match, t=html_tag: f"<{t}>{match.group(1).strip()}</{t.split()[0]}>",
                content,
                flags=re.DOTALL,
            )

        return content

